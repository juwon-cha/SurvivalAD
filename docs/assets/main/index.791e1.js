window.__require=function t(e,o,r){function n(a,c){if(!o[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!c&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var p=o[a]={exports:{}};e[a][0].call(p.exports,function(t){return n(e[a][1][t]||t)},p,p.exports,t,e,o,r)}return o[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<r.length;a++)n(r[a]);return n}({CameraFollow:[function(t,e,o){"use strict";cc._RF.push(e,"5cda0tpvI1ObJC8lKZK/1cP","CameraFollow");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e.smoothing=.1,e.mapNode=null,e.camera=null,e}return n(e,t),e.prototype.start=function(){this.camera=this.getComponent(cc.Camera)},e.prototype.lateUpdate=function(){if(this.target){var t=new cc.Vec3(this.target.position.x,this.target.position.y,this.node.position.z),e=this.node.position.lerp(t,this.smoothing);if(this.mapNode&&this.camera){var o=this.camera.zoomRatio,r=cc.winSize.width/2/o,n=cc.winSize.height/2/o,i=this.mapNode.width/2,a=this.mapNode.height/2,c=-i+r,s=i-r,l=-a+n,p=a-n;e.x=c<s?cc.misc.clampf(e.x,c,s):0,e.y=l<p?cc.misc.clampf(e.y,l,p):0}this.node.setPosition(e)}},i([s(cc.Node)],e.prototype,"target",void 0),i([s],e.prototype,"smoothing",void 0),i([s(cc.Node)],e.prototype,"mapNode",void 0),i([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],DroppedItem:[function(t,e,o){"use strict";cc._RF.push(e,"d3a35BnBMhPOKdwGY922LZ9","DroppedItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([c],e)}(cc.Component));o.default=s,cc._RF.pop()},{}],FenceManager:[function(t,e,o){"use strict";cc._RF.push(e,"03376ysKUJKm6wWVD+5nYMt","FenceManager");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fenceGroup=null,e.gateNode=null,e.leftDoor=null,e.rightDoor=null,e.playerNode=null,e.fenceRects=[],e.isGateOpen=!1,e.gateTriggerRadius=100,e.leftDoorOriginX=0,e.rightDoorOriginX=0,e}return n(e,t),e.prototype.start=function(){var t=this;this.fenceGroup&&this.fenceGroup.children.forEach(function(e){if(e.width>0&&e.height>0){var o=e.getBoundingBoxToWorld();t.fenceRects.push(o)}}),this.leftDoor&&(this.leftDoorOriginX=this.leftDoor.x),this.rightDoor&&(this.rightDoorOriginX=this.rightDoor.x)},e.prototype.setPlayer=function(t){this.playerNode=t},e.prototype.update=function(){if(this.playerNode&&this.gateNode){var t=this.playerNode.parent.convertToWorldSpaceAR(this.playerNode.position),e=this.gateNode.parent.convertToWorldSpaceAR(this.gateNode.position);cc.v2(t.x,t.y).sub(cc.v2(e.x,e.y)).mag()<this.gateTriggerRadius?this.isGateOpen||this.openGate():this.isGateOpen&&this.closeGate()}},e.prototype.validateMovement=function(t,e){if(0===this.fenceRects.length||!this.playerNode)return e;for(var o=t.add(e),r=this.playerNode.parent.convertToWorldSpaceAR(o),n=new cc.Rect(r.x-20,r.y-20,40,40),i=0,a=this.fenceRects;i<a.length;i++)if(a[i].intersects(n)){for(var c=cc.Vec3.ZERO,s=t.add(cc.v3(e.x,0,0)),l=this.playerNode.parent.convertToWorldSpaceAR(s),p=new cc.Rect(l.x-20,l.y-20,40,40),h=!1,u=0,d=this.fenceRects;u<d.length;u++)if(d[u].intersects(p)){h=!0;break}h||(c.x=e.x);for(var f=t.add(cc.v3(0,e.y,0)),y=this.playerNode.parent.convertToWorldSpaceAR(f),g=new cc.Rect(y.x-20,y.y-20,40,40),m=!1,v=0,_=this.fenceRects;v<_.length;v++)if(_[v].intersects(g)){m=!0;break}return m||(c.y=e.y),c}return e},e.prototype.openGate=function(){if(!this.isGateOpen){this.isGateOpen=!0,cc.Tween.stopAllByTarget(this.leftDoor),cc.Tween.stopAllByTarget(this.rightDoor);var t=.9*this.leftDoor.width;cc.tween(this.leftDoor).to(.5,{x:this.leftDoorOriginX-t},{easing:"cubicOut"}).start(),cc.tween(this.rightDoor).to(.5,{x:this.rightDoorOriginX+t},{easing:"cubicOut"}).start()}},e.prototype.closeGate=function(){this.isGateOpen&&(this.isGateOpen=!1,cc.Tween.stopAllByTarget(this.leftDoor),cc.Tween.stopAllByTarget(this.rightDoor),cc.tween(this.leftDoor).to(.5,{x:this.leftDoorOriginX},{easing:"cubicIn"}).start(),cc.tween(this.rightDoor).to(.5,{x:this.rightDoorOriginX},{easing:"cubicIn"}).start())},i([s(cc.Node)],e.prototype,"fenceGroup",void 0),i([s(cc.Node)],e.prototype,"gateNode",void 0),i([s(cc.Node)],e.prototype,"leftDoor",void 0),i([s(cc.Node)],e.prototype,"rightDoor",void 0),i([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],GameManager:[function(t,e,o){"use strict";cc._RF.push(e,"0d53a4ql7dEKoS2vDli1XAH","GameManager");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./MonsterManager"),c=t("./ItemManager"),s=t("./CameraFollow"),l=t("./FenceManager"),p=cc._decorator,h=p.ccclass,u=p.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapNode=null,e.monsterManager=null,e.itemManager=null,e.playerPrefab=null,e.cameraFollow=null,e.gameLayer=null,e.fenceManager=null,e.playerInstance=null,e}var o;return n(e,t),o=e,e.prototype.onLoad=function(){null===o.instance?o.instance=this:this.destroy()},e.prototype.start=function(){if(this.monsterManager)if(this.itemManager)if(this.playerPrefab)if(this.cameraFollow)if(this.gameLayer)if(this.fenceManager){this.playerInstance=cc.instantiate(this.playerPrefab),this.playerInstance.parent=this.gameLayer,this.playerInstance.setPosition(this.cameraFollow.node.position);var t=this.playerInstance.getComponent("PlayerController");t&&(t.mapNode=this.mapNode,t.fenceManager=this.fenceManager),this.fenceManager.setPlayer(this.playerInstance),this.cameraFollow.target=this.playerInstance,this.monsterManager.setPlayerTarget(this.playerInstance),this.monsterManager.initialSpawn()}else cc.error("GameManager: 'fenceManager' is not assigned.");else cc.error("GameManager: 'gameLayer' is not assigned.");else cc.error("GameManager: 'cameraFollow' is not assigned.");else cc.error("GameManager: 'playerPrefab' is not assigned.");else cc.error("GameManager: 'itemManager' is not assigned.");else cc.error("GameManager: 'monsterManager' is not assigned.")},e.instance=null,i([u(cc.Node)],e.prototype,"mapNode",void 0),i([u(a.default)],e.prototype,"monsterManager",void 0),i([u(c.default)],e.prototype,"itemManager",void 0),i([u(cc.Prefab)],e.prototype,"playerPrefab",void 0),i([u(s.default)],e.prototype,"cameraFollow",void 0),i([u(cc.Node)],e.prototype,"gameLayer",void 0),i([u(l.default)],e.prototype,"fenceManager",void 0),o=i([h],e)}(cc.Component);o.default=d,cc._RF.pop()},{"./CameraFollow":"CameraFollow","./FenceManager":"FenceManager","./ItemManager":"ItemManager","./MonsterManager":"MonsterManager"}],HealthBar:[function(t,e,o){"use strict";cc._RF.push(e,"c74f7KqSApOjp4zHU10QAmU","HealthBar");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.foreground=null,e}return n(e,t),e.prototype.updateHealth=function(t,e){if(this.foreground){var o=this.foreground.getComponent(cc.Sprite);if(o&&o.type===cc.Sprite.Type.FILLED){var r=Math.max(0,t/e);o.fillRange=r}else cc.warn("HealthBar: foreground sprite is not of type FILLED. Cannot update fillRange.")}},i([s(cc.Node)],e.prototype,"foreground",void 0),i([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],ItemManager:[function(t,e,o){"use strict";cc._RF.push(e,"6f033TpIB5GQKIfwZ6AC7rW","ItemManager");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemPrefab=null,e.itemLayer=null,e.activeItems=[],e}return n(e,t),e.prototype.onLoad=function(){this.itemPool=new cc.NodePool("DroppedItem")},e.prototype.start=function(){if(this.itemPrefab)if(this.itemLayer)for(var t=0;t<20;++t){var e=cc.instantiate(this.itemPrefab);this.itemPool.put(e)}else cc.error("ItemManager: 'itemLayer' is not assigned. Please assign a node for items to be children of.");else cc.error("ItemManager: 'itemPrefab' is not assigned. Please assign an item prefab in the editor.")},e.prototype.spawnItem=function(t){var e=null;(e=this.itemPool.size()>0?this.itemPool.get():cc.instantiate(this.itemPrefab)).parent=this.itemLayer;var o=this.itemLayer.convertToNodeSpaceAR(t);e.setPosition(o),this.activeItems.push(e),e.scale=1,e.angle=0;var r=80*(Math.random()-.5),n=80*(Math.random()-.5);return cc.tween(e).by(.4,{position:cc.v3(r,n,0)},{easing:"bounceOut"}).start(),e},e.prototype.despawnItem=function(t){var e=this.activeItems.indexOf(t);e>-1&&this.activeItems.splice(e,1),this.itemPool.put(t)},e.prototype.notifyItemCollected=function(t){var e=this.activeItems.indexOf(t);e>-1&&this.activeItems.splice(e,1)},i([s(cc.Prefab)],e.prototype,"itemPrefab",void 0),i([s(cc.Node)],e.prototype,"itemLayer",void 0),i([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],Joystick:[function(t,e,o){"use strict";cc._RF.push(e,"c96d0vK7lFE+Yuw7+IHTkzs","Joystick");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stickNode=null,e.maxRadius=100,e.camera=null,e.dir=cc.v2(0,0),e.power=0,e._touchStartWorldPos=new cc.Vec3,e._currentTouchWorldPos=new cc.Vec3,e}return n(e,t),e.prototype.onLoad=function(){this.reset(),this.node.active=!1,this.camera||cc.error("Joystick \ucef4\ud3ec\ub10c\ud2b8\uc758 Camera \uc18d\uc131\uc5d0 UICamera\ub97c \ubc18\ub4dc\uc2dc \uc5f0\uacb0\ud574\uc57c \ud569\ub2c8\ub2e4!")},e.prototype.onTouchStart=function(t){if(this.camera){this.node.active=!0,this.camera.getScreenToWorldPoint(t,this._touchStartWorldPos);var e=this.node.parent.convertToNodeSpaceAR(this._touchStartWorldPos);this.node.setPosition(e),this.reset()}},e.prototype.onTouchMove=function(t){if(this.camera){this.camera.getScreenToWorldPoint(t,this._currentTouchWorldPos);var e=this._currentTouchWorldPos.subtract(this._touchStartWorldPos),o=e.mag();this.power=Math.min(o/this.maxRadius,1),o>0&&(this.dir=cc.v2(e.x,e.y).normalize());var r=cc.v2(e.x,e.y);o>this.maxRadius&&(r=r.normalize().mul(this.maxRadius)),this.stickNode.setPosition(r)}},e.prototype.onTouchEnd=function(){this.reset(),this.node.active=!1},e.prototype.reset=function(){this.dir=cc.v2(0,0),this.power=0,this.stickNode.setPosition(0,0)},i([s(cc.Node)],e.prototype,"stickNode",void 0),i([s],e.prototype,"maxRadius",void 0),i([s({type:cc.Camera,tooltip:"UI\ub97c \ub80c\ub354\ub9c1\ud558\ub294 UICamera\ub97c \uc5f0\uacb0\ud574\uc8fc\uc138\uc694."})],e.prototype,"camera",void 0),i([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],MonsterManager:[function(t,e,o){"use strict";cc._RF.push(e,"f4cc8IOBshC1Zlsk+n/azFc","MonsterManager");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./Monster"),c=cc._decorator,s=c.ccclass,l=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.monsterPrefab=null,e.healthBarPrefab=null,e.monsterLayer=null,e.huntingArea=null,e.maxMonsters=20,e.baseSpeed=30,e.speedVariance=20,e.detectionRange=200,e.playerNode=null,e._huntingAreaWorldRect=null,e.activeMonsters=[],e}return n(e,t),e.prototype.onLoad=function(){this.monsterPool=new cc.NodePool("Monster"),this.healthBarPool=new cc.NodePool("HealthBar")},e.prototype.start=function(){var t=this;this.monsterPrefab?this.healthBarPrefab?this.monsterLayer?this.huntingArea?this.scheduleOnce(function(){t.initHuntingAreaRect(),t.initialSpawn()},.1):cc.error("MonsterManager: 'huntingArea' is not set. Please assign the hunting area node in the editor."):cc.error("MonsterManager: 'monsterLayer' is not assigned. Please assign a node for monsters to be children of."):cc.error("MonsterManager: 'healthBarPrefab' is not assigned. Please assign the HealthBar prefab in the editor."):cc.error("MonsterManager: 'monsterPrefab' is not assigned. Please assign a monster prefab in the editor.")},e.prototype.initHuntingAreaRect=function(){var t=this.huntingArea,e=t.width,o=t.height,r=t.anchorX,n=t.anchorY,i=cc.v2(-e*r,-o*n),a=cc.v2(e*(1-r),o*(1-n)),c=t.convertToWorldSpaceAR(i),s=t.convertToWorldSpaceAR(a),l=Math.min(c.x,s.x),p=Math.min(c.y,s.y),h=Math.max(c.x,s.x),u=Math.max(c.y,s.y);this._huntingAreaWorldRect=new cc.Rect(l,p,h-l,u-p),console.log("[MonsterManager] Hunting Area Init: "+this._huntingAreaWorldRect)},e.prototype.setPlayerTarget=function(t){this.playerNode=t},e.prototype.getHealthBar=function(){return this.healthBarPool.size()>0?this.healthBarPool.get():cc.instantiate(this.healthBarPrefab)},e.prototype.putHealthBar=function(t){this.healthBarPool.put(t)},e.prototype.initialSpawn=function(){for(var t=0;t<this.maxMonsters;t++)this.spawnMonster()},e.prototype.spawnMonster=function(){if(!(this.activeMonsters.length>=this.maxMonsters))if(this._huntingAreaWorldRect){var t=null;t=this.monsterPool.size()>0?this.monsterPool.get(this):cc.instantiate(this.monsterPrefab);var e=this.huntingArea.width/2,o=this.huntingArea.height/2,r=Math.random()*this.huntingArea.width-e,n=Math.random()*this.huntingArea.height-o,i=this.huntingArea.convertToWorldSpaceAR(cc.v2(r,n)),c=this.monsterLayer.convertToNodeSpaceAR(i);t.parent=this.monsterLayer,t.position=cc.v3(c.x,c.y,0);var s=this.baseSpeed+(Math.random()-.5)*this.speedVariance;t.getComponent(a.default).init(s,this.playerNode,this.detectionRange,this._huntingAreaWorldRect),this.activeMonsters.push(t)}else console.warn("[MonsterManager] Hunting Area not ready yet.")},e.prototype.despawnMonster=function(t){var e=this.activeMonsters.indexOf(t);e>-1&&this.activeMonsters.splice(e,1),this.monsterPool.put(t),this.scheduleOnce(this.spawnMonster,1)},i([l(cc.Prefab)],e.prototype,"monsterPrefab",void 0),i([l(cc.Prefab)],e.prototype,"healthBarPrefab",void 0),i([l(cc.Node)],e.prototype,"monsterLayer",void 0),i([l(cc.Node)],e.prototype,"huntingArea",void 0),i([l],e.prototype,"maxMonsters",void 0),i([l({tooltip:"\ubaac\uc2a4\ud130 \uae30\ubcf8 \uc774\ub3d9 \uc18d\ub3c4"})],e.prototype,"baseSpeed",void 0),i([l({tooltip:"\uc18d\ub3c4 \ub79c\ub364 \ubc94\uc704 (\uc608: 20\uc774\uba74 baseSpeed \xb1 10)"})],e.prototype,"speedVariance",void 0),i([l],e.prototype,"detectionRange",void 0),i([s],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./Monster":"Monster"}],Monster:[function(t,e,o){"use strict";cc._RF.push(e,"f2405ty2kpLDq2aPsZQ/QtR","Monster");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./GameManager"),c=t("./HealthBar"),s=cc._decorator,l=s.ccclass,p=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxHp=30,e.hp=30,e.healthBarOffsetY=120,e.bodyNode=null,e.PATROL_SPEED_RATIO=.9,e.PATROL_WAIT_TIME=1,e.ARRIVAL_THRESHOLD=10,e.speed=0,e.detectionRange=0,e.huntingAreaWorldRect=null,e.healthBar=null,e.playerNode=null,e.patrolTargetWorldPos=null,e.idleTimer=0,e}return n(e,t),e.prototype.init=function(t,e,o,r){this.hp=this.maxHp,this.node.active=!0,this.node.color=cc.Color.WHITE,this.node.opacity=255;var n=this.bodyNode?this.bodyNode:this.node;cc.Tween.stopAllByTarget(n),n.color=cc.Color.WHITE,n.scaleX=Math.abs(n.scaleX),this.speed=t,this.playerNode=e,this.detectionRange=o,this.huntingAreaWorldRect=r,this.patrolTargetWorldPos=null,this.idleTimer=0;var i=a.default.instance.monsterManager.getHealthBar();this.healthBar=i.getComponent(c.default),i.parent=this.node,i.setPosition(0,this.healthBarOffsetY),i.scaleX=1,this.healthBar.updateHealth(this.hp,this.maxHp),this.healthBar.node.active=!0},e.prototype.takeDamage=function(t){if(this.node.active){this.hp-=t,this.healthBar&&this.healthBar.updateHealth(this.hp,this.maxHp);var e=this.bodyNode?this.bodyNode:this.node;cc.Tween.stopAllByTarget(e),cc.tween(e).to(.05,{color:cc.Color.RED}).to(.05,{color:cc.Color.WHITE}).start(),this.hp<=0&&this.die()}},e.prototype.die=function(){var t=this.bodyNode?this.bodyNode:this.node;cc.Tween.stopAllByTarget(t);var e=this.node.parent.convertToWorldSpaceAR(this.node.position);a.default.instance.itemManager.spawnItem(cc.v3(e.x,e.y,0)),this.healthBar&&(a.default.instance.monsterManager.putHealthBar(this.healthBar.node),this.healthBar=null),a.default.instance.monsterManager.despawnMonster(this.node)},e.prototype.update=function(t){if(this.playerNode&&this.playerNode.active){var e=this.node.parent.convertToWorldSpaceAR(this.node.position),o=this.playerNode.parent.convertToWorldSpaceAR(this.playerNode.position),r=cc.v2(e.x,e.y),n=cc.v2(o.x,o.y);r.sub(n).mag()<=this.detectionRange?(this.patrolTargetWorldPos=null,this.idleTimer=0,this.moveTowards(r,n,this.speed,t)):this.updatePatrol(r,t)}},e.prototype.updatePatrol=function(t,e){this.idleTimer>0?this.idleTimer-=e:this.patrolTargetWorldPos?t.sub(this.patrolTargetWorldPos).mag()<this.ARRIVAL_THRESHOLD?(this.patrolTargetWorldPos=null,this.idleTimer=this.PATROL_WAIT_TIME):this.moveTowards(t,this.patrolTargetWorldPos,this.speed*this.PATROL_SPEED_RATIO,e):this.setNewPatrolTarget()},e.prototype.setNewPatrolTarget=function(){if(this.huntingAreaWorldRect){var t=this.huntingAreaWorldRect,e=t.x+Math.random()*t.width,o=t.y+Math.random()*t.height;this.patrolTargetWorldPos=cc.v2(e,o)}},e.prototype.moveTowards=function(t,e,o,r){var n=e.sub(t).normalize().mul(o*r);if(Math.abs(n.x)>.1){var i=n.x>0?1:-1;this.bodyNode?this.bodyNode.scaleX=Math.abs(this.bodyNode.scaleX)*i:(this.node.scaleX=Math.abs(this.node.scaleX)*i,this.healthBar&&(this.healthBar.node.scaleX=i))}var a=t.add(n);if(this.huntingAreaWorldRect){var c=this.huntingAreaWorldRect;a.x=cc.misc.clampf(a.x,c.xMin,c.xMax),a.y=cc.misc.clampf(a.y,c.yMin,c.yMax)}var s=this.node.parent.convertToNodeSpaceAR(cc.v3(a.x,a.y,0));this.node.setPosition(s)},i([p],e.prototype,"maxHp",void 0),i([p],e.prototype,"healthBarOffsetY",void 0),i([p(cc.Node)],e.prototype,"bodyNode",void 0),i([l],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./GameManager":"GameManager","./HealthBar":"HealthBar"}],PlayerController:[function(t,e,o){"use strict";cc._RF.push(e,"90cdeWH0CZATrIhvU3SPExI","PlayerController");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./GameManager"),c=t("./Monster"),s=cc._decorator,l=s.ccclass,p=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.joystick=null,e.fenceManager=null,e.mapNode=null,e.boundaryPadding=0,e.moveSpeed=300,e.stackContainer=null,e.attackNudgeDistance=50,e.attackRange=200,e.attackDamage=10,e.attackCooldown=.5,e.attackTimer=0,e.collectRadius=100,e.itemStack=[],e.stackHeight=10,e.originalPosition=cc.v3(),e.isAttacking=!1,e.stackContainerOriginalX=0,e.debugGraphics=null,e.debugCollectGraphics=null,e.bodyAnim=null,e.isMoving=!1,e}return n(e,t),e.prototype.setJoystick=function(t){this.joystick=t},e.prototype.start=function(){this.stackContainer?(this.stackContainerOriginalX=this.stackContainer.x,this.bodyAnim||(this.bodyAnim=this.getComponentInChildren(cc.Animation)),this.bodyAnim?this.playAnimation("Idle"):cc.warn("PlayerController: Animation component not found!"),cc.director.getPhysicsManager().enabled=!0):cc.error("PlayerController: stackContainer missing.")},e.prototype.update=function(t){if(!this.isAttacking){var e=!1,o=cc.Vec3.ZERO;if(this.joystick&&this.joystick.power>0){e=!0;var r=this.moveSpeed*this.joystick.power;if(o=new cc.Vec3(this.joystick.dir.x,this.joystick.dir.y,0).mul(r*t),this.fenceManager&&(o=this.fenceManager.validateMovement(this.node.position,o)),this.node.position=this.node.position.add(o),0!==o.x){var n=o.x>0?1:-1;this.setFacingDirection(n)}}if(this.mapNode){var i=this.mapNode.width/2,a=this.mapNode.height/2,c=this.node.width*Math.abs(this.node.scaleX)/2,s=this.node.height*Math.abs(this.node.scaleY)/2,l=-i+c+this.boundaryPadding,p=i-c-this.boundaryPadding,h=-a+s+this.boundaryPadding,u=a-s-this.boundaryPadding;this.node.x=l<p?cc.misc.clampf(this.node.x,l,p):0,this.node.y=h<u?cc.misc.clampf(this.node.y,h,u):0}e&&o.mag()>0?this.isMoving||(this.isMoving=!0,this.playAnimation("Walk")):this.isMoving&&(this.isMoving=!1,this.playAnimation("Idle")),this.attackTimer+=t,this.attackTimer>=this.attackCooldown&&this.findAndAttackMonster(),this.checkItemCollection()}},e.prototype.setFacingDirection=function(t){this.bodyAnim?this.bodyAnim.node.scaleX=Math.abs(this.bodyAnim.node.scaleX)*t:this.node.scaleX=Math.abs(this.node.scaleX)*t,this.stackContainer&&(this.stackContainer.x=this.stackContainerOriginalX*t)},e.prototype.playAnimation=function(t){this.bodyAnim&&(this.bodyAnim.getAnimationState(t)?this.bodyAnim.play(t):cc.warn("Animation clip '"+t+"' not found!"))},e.prototype.findAndAttackMonster=function(){if(!this.isAttacking){var t=a.default.instance.monsterManager.activeMonsters;if(t&&0!==t.length){var e=null,o=this.attackRange*this.attackRange,r=cc.Camera.main;if(r){var n=cc.v2();r.getWorldToScreenPoint(this.node.parent.convertToWorldSpaceAR(this.node.position),n);for(var i=0,c=t;i<c.length;i++){var s=c[i];if(s.active){var l=cc.v2();r.getWorldToScreenPoint(s.parent.convertToWorldSpaceAR(s.position),l);var p=n.sub(l).magSqr();p<=o&&(o=p,e=s)}}e&&(this.attack(e),this.attackTimer=0)}}}},e.prototype.attack=function(t){var e=this;this.isAttacking=!0,this.originalPosition=this.node.position.clone();var o=t.parent.convertToWorldSpaceAR(t.position),r=this.node.parent.convertToNodeSpaceAR(o),n=cc.v2(this.originalPosition.x,this.originalPosition.y),i=cc.v2(r.x,r.y).sub(n);if(Math.abs(i.x)>.1){var a=i.x>0?1:-1;this.setFacingDirection(a)}this.playAnimation("Attack");var s=i.normalize().mul(this.attackNudgeDistance),l=this.originalPosition.x+s.x,p=this.originalPosition.y+s.y;cc.tween(this.node).to(.1,{x:l,y:p},{easing:"quadOut"}).call(function(){if(cc.isValid(t)&&t.active){var o=t.getComponent(c.default);o&&o.takeDamage(e.attackDamage)}}).to(.15,{x:this.originalPosition.x,y:this.originalPosition.y},{easing:"quadIn"}).call(function(){e.isAttacking=!1,e.joystick&&e.joystick.power>0?(e.playAnimation("Walk"),e.isMoving=!0):(e.playAnimation("Idle"),e.isMoving=!1)}).start()},e.prototype.checkItemCollection=function(){var t=a.default.instance.itemManager.activeItems;if(t&&0!==t.length){var e=cc.Camera.main;if(e){var o=this.collectRadius*this.collectRadius;if(this.node.parent){var r=cc.v2();e.getWorldToScreenPoint(this.node.parent.convertToWorldSpaceAR(this.node.position),r);for(var n=t.length-1;n>=0;n--){var i=t[n];if(cc.isValid(i)){if(i.active&&i.parent){var c=cc.v2();e.getWorldToScreenPoint(i.parent.convertToWorldSpaceAR(i.position),c);var s=r.sub(c).magSqr();Math.sqrt(s),s<o&&(console.log("\uc544\uc774\ud15c \uc218\uc9d1 \uc131\uacf5!"),this.collectItem(i))}}else a.default.instance.itemManager.activeItems.splice(n,1)}}}else cc.warn("checkItemCollection: Main camera not found.")}},e.prototype.collectItem=function(t){if(-1!==a.default.instance.itemManager.activeItems.indexOf(t)){a.default.instance.itemManager.notifyItemCollected(t),cc.Tween.stopAllByTarget(t);var e=t.parent.convertToWorldSpaceAR(t.position);t.parent=this.stackContainer;var o=this.stackContainer.convertToNodeSpaceAR(e);t.setPosition(o),t.scale=1,t.angle=0,t.opacity=255,t.active=!0;var r=this.itemStack.length*this.stackHeight;cc.tween(t).to(.2,{x:0,y:r,scale:.8},{easing:"backOut"}).call(function(){t.setPosition(0,r),t.setScale(.8)}).start(),this.itemStack.push(t)}},e.prototype.popItem=function(){return 0===this.itemStack.length?null:this.itemStack.pop()},i([p(cc.Node)],e.prototype,"mapNode",void 0),i([p({tooltip:"\ub9f5 \uacbd\uacc4\uc640 \ud50c\ub808\uc774\uc5b4 \uc0ac\uc774\uc758 \uc5ec\uc720 \uacf5\uac04 (\ud53d\uc140)"})],e.prototype,"boundaryPadding",void 0),i([p],e.prototype,"moveSpeed",void 0),i([p(cc.Node)],e.prototype,"stackContainer",void 0),i([p({tooltip:"\uacf5\uaca9 \uc2dc \ubaac\uc2a4\ud130 \ubc29\ud5a5\uc73c\ub85c \uc0b4\uc9dd \uc6c0\uc9c1\uc774\ub294 \uac70\ub9ac\uc785\ub2c8\ub2e4."})],e.prototype,"attackNudgeDistance",void 0),i([p],e.prototype,"attackRange",void 0),i([p],e.prototype,"attackDamage",void 0),i([p],e.prototype,"attackCooldown",void 0),i([p],e.prototype,"collectRadius",void 0),i([p({type:cc.Animation,tooltip:"\uc790\uc2dd \ub178\ub4dc(\uc2a4\ud504\ub77c\uc774\ud2b8)\uc5d0 \uc788\ub294 Animation \ucef4\ud3ec\ub10c\ud2b8\ub97c \uc5f0\uacb0\ud558\uc138\uc694."})],e.prototype,"bodyAnim",void 0),i([l],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./GameManager":"GameManager","./Monster":"Monster"}],TouchInputManager:[function(t,e,o){"use strict";cc._RF.push(e,"789b8Ux6e1I0LheWEM8z1MW","TouchInputManager");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./Joystick"),c=t("./PlayerController"),s=t("./GameManager"),l=cc._decorator,p=l.ccclass,h=l.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.joystick=null,e.touchArea=null,e.playerController=null,e.touchId=null,e}return n(e,t),e.prototype.onLoad=function(){this.joystick?(this.joystick.node.active=!1,this.touchArea.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touchArea.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touchArea.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchArea.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)):cc.error("TouchInputManager: Joystick is not assigned.")},e.prototype.start=function(){var t=this;this.scheduleOnce(function(){s.default.instance&&s.default.instance.playerInstance&&(t.playerController=s.default.instance.playerInstance.getComponent(c.default),t.playerController&&t.playerController.setJoystick(t.joystick))},.1)},e.prototype.onTouchStart=function(t){null===this.touchId&&(this.touchId=t.getID(),this.joystick.onTouchStart(t.getLocation()))},e.prototype.onTouchMove=function(t){t.getID()===this.touchId&&this.joystick.onTouchMove(t.getLocation())},e.prototype.onTouchEnd=function(t){t.getID()===this.touchId&&(this.joystick.onTouchEnd(),this.touchId=null)},i([h(a.default)],e.prototype,"joystick",void 0),i([h(cc.Node)],e.prototype,"touchArea",void 0),i([p],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./GameManager":"GameManager","./Joystick":"Joystick","./PlayerController":"PlayerController"}],UpgradeZone:[function(t,e,o){"use strict";cc._RF.push(e,"14d2bMi+/5MGqyC18/UBaU5","UpgradeZone");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./PlayerController"),c=t("./GameManager"),s=cc._decorator,l=s.ccclass,p=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.requiredItems=10,e.detectionRadius=200,e.successParticle=null,e.progressLabel=null,e.currentItems=0,e.consumeTimer=0,e.player=null,e.debugGraphics=null,e}return n(e,t),e.prototype.start=function(){this.successParticle&&(this.successParticle.stopSystem(),this.successParticle.node.active=!1),this.updateProgressLabel()},e.prototype.createDebugGraphics=function(){var t=new cc.Node("DebugZoneRange");t.parent=this.node,t.setPosition(0,0),t.zIndex=-1,this.debugGraphics=t.addComponent(cc.Graphics),this.debugGraphics.lineWidth=5,this.debugGraphics.strokeColor=cc.Color.YELLOW,this.debugGraphics.circle(0,0,this.detectionRadius),this.debugGraphics.stroke()},e.prototype.updateProgressLabel=function(){this.progressLabel&&(this.progressLabel.string=this.currentItems+" / "+this.requiredItems,this.progressLabel.node.stopAllActions(),this.progressLabel.node.scale=1.5,cc.tween(this.progressLabel.node).to(.1,{scale:1},{easing:"backOut"}).start())},e.prototype.update=function(t){if(!this.player&&c.default.instance&&c.default.instance.playerInstance&&(this.player=c.default.instance.playerInstance.getComponent(a.default)),this.player){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),o=this.player.node.convertToWorldSpaceAR(cc.v2(0,0)),r=cc.v2(e.x,e.y),n=cc.v2(o.x,o.y);r.sub(n).mag()<=this.detectionRadius&&this.player.itemStack.length>0&&this.currentItems<this.requiredItems&&(this.consumeTimer+=t,this.consumeTimer>.1&&(this.consumeItem(),this.consumeTimer=0))}},e.prototype.consumeItem=function(){var t=this;if(this.player){var e=this.player.popItem();if(e){var o=e.parent.convertToWorldSpaceAR(e.position);e.parent=this.node;var r=this.node.convertToNodeSpaceAR(o);e.setPosition(r),cc.tween(e).to(.3,{position:cc.v3(0,0,0),scale:.5},{easing:"backIn"}).call(function(){c.default.instance.itemManager.despawnItem(e),t.currentItems++,t.updateProgressLabel(),t.checkUpgrade()}).start()}}},e.prototype.checkUpgrade=function(){this.currentItems>=this.requiredItems&&(console.log("UPGRADE COMPLETE!"),this.player&&(this.player.attackDamage+=5),this.currentItems=0,this.requiredItems+=5,this.updateProgressLabel(),cc.tween(this.node).to(.1,{scale:1.2}).to(.1,{scale:1}).start(),this.successParticle&&(this.successParticle.node.active=!0,this.successParticle.resetSystem(),this.successParticle.node.scale=.5,cc.tween(this.successParticle.node).to(.3,{scale:1.5},{easing:"backOut"}).start()))},i([p],e.prototype,"requiredItems",void 0),i([p],e.prototype,"detectionRadius",void 0),i([p(cc.ParticleSystem)],e.prototype,"successParticle",void 0),i([p(cc.Label)],e.prototype,"progressLabel",void 0),i([l],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./GameManager":"GameManager","./PlayerController":"PlayerController"}]},{},["CameraFollow","DroppedItem","FenceManager","GameManager","HealthBar","ItemManager","Joystick","Monster","MonsterManager","PlayerController","TouchInputManager","UpgradeZone"]);